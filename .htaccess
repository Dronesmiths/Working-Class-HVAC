# Working Class HVAC - SEO Redirects & Security
RewriteEngine On

# 1. Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# 2. Redirect date-based blog posts to new flat structure
# Example: /2023/12/26/slug/ -> /blog/slug/
RewriteRule ^[0-9]{4}/[0-9]{2}/[0-9]{2}/([^/]+)/?$ /blog/$1/ [L,R=301]

# 3. Redirect old service paths
RewriteRule ^emergency-hvac-repair-services/?$ /services/emergency-service/ [L,R=301]
RewriteRule ^hvac-maintenance-services/?$ /services/maintenance/ [L,R=301]
RewriteRule ^heat-pump-installation/?$ /services/heating-cooling/ [L,R=301]
RewriteRule ^services-v1/mosquitos/?$ /services/ [L,R=301]

# 4. Cleanup old financing and lead-gen pages
RewriteRule ^f1-financing-1/?$ /contact/ [L,R=301]
RewriteRule ^benji-renovate-america/?$ /contact/ [L,R=301]
RewriteRule ^hero-renovate-america-1/?$ /contact/ [L,R=301]

# 5. Redirect non-core locations to homepage (Out of current service area)
# This fixes the 404s for distant locations seen in Search Console
RewriteRule ^locations/(glendale|woodland-hills|san-bernardino|rancho-cucamonga|valencia|porter-ranch|reseda|chatsworth|encino|san-dimas|chino|calabasas|tarzana|van-nuys|ontario|santa-clarita|monrovia|sherman-oaks|pomona|claremont|covina|chino-hills|upland|pasadena|granada-hills|fontana|burbank|rialto|arcadia)/?$ / [L,R=301]

# 6. Fallback for any other /locations/ that aren't in our active list
# Active list: lancaster, palmdale, quartz-hill, rosamond, lake-los-angeles, littlerock
RewriteCond %{REQUEST_URI} ^/locations/
RewriteCond %{REQUEST_URI} !^/locations/(lancaster|palmdale|quartz-hill|rosamond|lake-los-angeles|littlerock)
RewriteRule ^locations/.*$ / [L,R=301]

# 7. Browser Caching for Performance
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    ExpiresDefault "access plus 2 days"
</IfModule>
